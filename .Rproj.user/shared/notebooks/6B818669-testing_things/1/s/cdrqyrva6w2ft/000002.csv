"0","bh_correction <- function(condition_to_correct, fdr, complete_dataset){"
"0","  original_condition_df <- subset(complete_dataset, "
"0","                                  condition==condition_to_correct)"
"0","  "
"0","  crit.val.df <- original_condition_df %>% "
"0","    filter(!is.na(pvalue)) %>%  # remove any NA pvalues. I think this makes sense. In any case it doesn't change the results much"
"0","    arrange(pvalue) %>%  # arrange the pvalues in ascending order"
"0","    mutate(""pval.rank"" = rank(pvalue), # rank pvalues with lower pval having lower rank (closer to 1)"
"0","           ""BH"" = (pval.rank / length(pval.rank)) * fdr) %>%  # Apply BH correction p / M * r"
"0","    filter(pvalue < BH) # We are searching for the highest pval that is lower than BH crit.val"
"0","  "
"0","  crit.pval <- max(crit.val.df$pvalue) # This would be the highest pvalue that is also lower than the BH value"
"0","  "
"0","  orginal_corrected <- original_condition_df %>% "
"0","    mutate(""corrected_de"" = case_when(pvalue <= crit.pval & log2FoldChange > 0 ~ 1,"
"0","                                      pvalue <= crit.pval & log2FoldChange < 0 ~ -1,"
"0","                                      TRUE ~ 0))"
"0","  "
"0","  return(orginal_corrected)"
"0","}"
"0",""
"0","apply_correction <- function(complete_df_salmonella, complete_df_campylobacter, fdr_chosen){"
"0","  "
"0","  complete_corrected_salmonella <- bind_rows(lapply(unique(complete_df_salmonella$condition), "
"0","                                             bh_correction,"
"0","                                             complete_dataset=complete_df_salmonella,"
"0","                                             fdr=fdr_chosen))"
"0","  "
"0","  complete_corrected_campylobacter <- bind_rows(lapply(unique(complete_df_campylobacter$condition), "
"0","                                                bh_correction,"
"0","                                                complete_dataset=complete_df_campylobacter,"
"0","                                                fdr=fdr_chosen))"
"0","  "
"0","  all_patterns <- bind_rows(complete_corrected_campylobacter, "
"0","                            complete_corrected_salmonella)"
"0","  "
"0","  return(all_patterns)"
"0","}"
